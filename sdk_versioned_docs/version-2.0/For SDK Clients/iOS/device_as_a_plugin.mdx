---
id: device-as-a-plugin
title: Device as a Plugin
sidebar_label: Device as a Plugin
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Device as a Plugin

This documentation introduces the new capabilities of the SDK for integrating external devices into your iOS application.

## âœ¨ Overview

The API enables seamless integration and management of external devices within your app. It supports:

1. **Device connection/disconnection flows** (e.g., adding or removing a device).
2. **Syncing data from devices**, categorized by module IDs, such as *"BloodGlucose"* or *"BloodPressure"*, enabling integration with specific application modules.

## ðŸ› ï¸ Implementation Guide

### 1. Define an External Device Provider

To integrate a new device, create a class or struct that conforms to the `AnyExternalDeviceProvider` protocol. This protocol requires you to implement the following properties and methods:

```swift
public protocol AnyExternalDeviceProvider: DeviceManufacturePresentable {
    var displayName: String { get }
    var devices: [ExternalDevice] { get }

    func isAdded(_ id: String) -> Bool
    func addDevice(_ id: String, in navigation: UINavigationController, completion: @escaping () -> Void)
    func removeDevice(_ id: String, in navigation: UINavigationController)
    func syncData(for device: ExternalDevice, _ completion: @escaping (Result<DeviceSyncResult, Error>) -> Void)
}
```

### 2. Define the Device Model

The ExternalDevice struct is used to represent a connected device; includes a supportedModuleID property to indicate which module the device integrates with::

```swift
public struct ExternalDevice: Hashable, DevicePresentable {
    public let identifier: String
    public let name: String
    public let model: String
    public var displayName: String? { name }
    let supportedModuleID: String

    public init(id: String, name: String, model: String, supportedModuleID: String) {
        self.identifier = id
        self.name = name
        self.model = model
        self.supportedModuleID = supportedModuleID
    }
}
```

### 3. Example Implementation

Here is an example of how you can implement a custom device provider:

```swift
import HumaAppKit
import HumaDevicesPlugin

final class MyDeviceProvider: AnyExternalDeviceProvider {
    var displayName: String { "My Custom Devices" }

    var devices: [ExternalDevice] = [
        ExternalDevice(id: "device_001", name: "Heart Rate Monitor", model: "HRM-1000"),
        ExternalDevice(id: "device_002", name: "Blood Pressure Monitor", model: "BPM-2000")
    ]

    func isAdded(_ id: String) -> Bool {
        return devices.contains { $0.id == id }
    }

    func addDevice(_ id: String, in navigation: UINavigationController, completion: @escaping () -> Void) {
        // Present UI to connect the device
        let viewController = DeviceSetupViewController(deviceId: id)
        navigation.pushViewController(viewController, animated: true)
        completion()
    }

    func removeDevice(_ id: String, in navigation: UINavigationController) {
        // Present UI to disconnect the device
        let alert = UIAlertController(title: "Remove Device", message: "Are you sure you want to remove this device?", preferredStyle: .alert)
        alert.addAction(UIAlertAction(title: "Yes", style: .destructive) { _ in
            // Handle removal logic here
        })
        alert.addAction(UIAlertAction(title: "Cancel", style: .cancel, handler: nil))
        navigation.present(alert, animated: true)
    }

    func syncData(
        for device: HumaDevicesPlugin.ExternalDevice,
        _ completion: @escaping (Result<HumaDevicesPlugin.DeviceSyncResult, any Error>) -> Void
    ) {
        // returning hardcoded blood pressure data in this example
        completion(.success(.dataSynced(.bloodPressure([.init(value: .init(min: 60, max: 120))]))))
    }
}
```

### 4. Register the Device Provider

Once you have implemented your custom device provider, register it in your AppDelegate during the application initialization:

```swift
import HumaAppKit
import HumaDevicesPlugin

@main
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        let devicePlugin = DevicesPlugin()
        devicePlugin.registerExternalDeviceProvider(MyDeviceProvider())
        
        HumaApp.initialize { app in
            app.configureDevices(devicePlugin)
        }

        return true
    }
}
```

### ðŸ“¦ Dependencies

```swift
import HumaAppKit
import HumaDevicesPlugin
```