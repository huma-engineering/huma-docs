---
id: device-as-a-plugin
title: Device as a Plugin
sidebar_label: Device as a Plugin
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Device as a Plugin

In this documentation, we introduce a new capability of the SDK that allows developers to integrate external devices into the iOS application using a plugin-based approach. This new API facilitates seamless integration of device connection/disconnection flows directly into the profile screen of your app.

This feature is currently focused on the **first part of the device integration**:

1. **Integrating device connection/disconnection flows into the profile screen**.
2. _(Coming Soon)_ Integrating external sources of data into modules.

## âœ¨ Overview

The new API offers a streamlined way to extend your application's functionality by embedding support for external devices as plugins. This approach simplifies the integration process and ensures a consistent user experience when managing connected devices.

To get started, implement the `AnyExternalDeviceProvider` protocol and register your custom device provider in the app.

## ğŸ› ï¸ Implementation Guide

### 1. Define an External Device Provider

To integrate a new device, create a class or struct that conforms to the `AnyExternalDeviceProvider` protocol. This protocol requires you to implement the following properties and methods:

```swift
public protocol AnyExternalDeviceProvider: DeviceManufacturePresentable {
    var displayName: String { get }
    var devices: [ExternalDevice] { get }

    func isAdded(_ id: String) -> Bool
    func addDevice(_ id: String, in navigation: UINavigationController, completion: @escaping () -> Void)
    func removeDevice(_ id: String, in navigation: UINavigationController)
}
```

### 2. Define the Device Model

The ExternalDevice struct is used to represent a connected device:

```swift
public struct ExternalDevice: Hashable, DevicePresentable {
    public let id: String
    public let name: String
    public let model: String

    public var displayName: String? { name }

    public init(id: String, name: String, model: String) {
        self.id = id
        self.name = name
        self.model = model
    }
}
```

### 3. Example Implementation

Here is an example of how you can implement a custom device provider:

```swift
import HumaAppKit
import HumaDevicesPlugin

final class MyDeviceProvider: AnyExternalDeviceProvider {
    var displayName: String { "My Custom Devices" }

    var devices: [ExternalDevice] = [
        ExternalDevice(id: "device_001", name: "Heart Rate Monitor", model: "HRM-1000"),
        ExternalDevice(id: "device_002", name: "Blood Pressure Monitor", model: "BPM-2000")
    ]

    func isAdded(_ id: String) -> Bool {
        return devices.contains { $0.id == id }
    }

    func addDevice(_ id: String, in navigation: UINavigationController, completion: @escaping () -> Void) {
        // Present UI to connect the device
        let viewController = DeviceSetupViewController(deviceId: id)
        navigation.pushViewController(viewController, animated: true)
        completion()
    }

    func removeDevice(_ id: String, in navigation: UINavigationController) {
        // Present UI to disconnect the device
        let alert = UIAlertController(title: "Remove Device", message: "Are you sure you want to remove this device?", preferredStyle: .alert)
        alert.addAction(UIAlertAction(title: "Yes", style: .destructive) { _ in
            // Handle removal logic here
        })
        alert.addAction(UIAlertAction(title: "Cancel", style: .cancel, handler: nil))
        navigation.present(alert, animated: true)
    }
}
```

### 4. Register the Device Provider

Once you have implemented your custom device provider, register it in your AppDelegate during the application initialization:

```swift
import HumaAppKit
import HumaDevicesPlugin

@main
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        let devicePlugin = DevicesPlugin()
        devicePlugin.registerExternalDeviceProvider(MyDeviceProvider())
        
        HumaApp.initialize { app in
            app.configureDevices(devicePlugin)
        }

        return true
    }
}
```

### ğŸ—’ï¸ Additional Notes

	â€¢	Make sure to import both HumaAppKit and HumaDevicesPlugin in your project.
	â€¢	This feature currently supports only device connection and disconnection flows. Data integration into modules will be available shortly.

### ğŸ“¦ Dependencies

```swift
import HumaAppKit
import HumaDevicesPlugin
```