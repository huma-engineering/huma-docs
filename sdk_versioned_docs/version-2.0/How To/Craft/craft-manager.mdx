---
id: craft-manager
title: CraftManager
sidebar_label: CraftManager
sidebar_position: 1
---

The `CraftManager` in the Craft Package enables developers to **fetch** and **submit** data records
to the HumaCraft backend.

To get the `CraftManager` instance, use the following method.

```kotlin
val craftManager = CraftManager.getInstance()
```

## Overview

`CraftManager` provides two core functions:

- `getDataRecord`: Retrieves records from the backend.
- `submitDataRecord`: Submits a record to the backend.

---

## `getDataRecord()`

Retrieves a specified data records from the HumaCraft backend.

### Function Signature

```kotlin
fun getDataRecord(
    modelName: String,
    addonId: String,
    addonVersion: String,
    endpointVersion: Int,
    limit: Int,
    onSuccess: (Any) -> Unit,
    onFailure: (Throwable) -> Unit
)
```

### Parameters

| Name              | Type                  | Description                                    |
|-------------------|-----------------------|------------------------------------------------|
| `modelName`       | `String`              | The name of the model to fetch.                |
| `addonId`         | `String`              | The unique identifier of the addon.            |
| `addonVersion`    | `String`              | The version of the addon being used.           |
| `endpointVersion` | `Int`                 | The API version of the endpoint.               |
| `limit`           | `Int`                 | The maximum number of records to retrieve.     |
| `onSuccess`       | `(Any) -> Unit`       | Callback invoked on successful data retrieval. |
| `onFailure`       | `(Throwable) -> Unit` | Callback invoked when an error occurs.         |

### Handling Callbacks in `getDataRecord`

#### `onSuccess` Callback

The `onSuccess` callback provides an `Any` object, which represents the retrieved data records.

Since `Any` is a generic type, you need to convert it into a specific data class that matches the
expected structure.

You can refer to the provided sample app for an example of how to properly parse and convert this
data.

#### `onFailure` Callback

The `onFailure` callback provides a `Throwable` object, which contains details about any errors that
occur during the data retrieval process. You can use this throwable to log errors, display
meaningful messages, or handle failures gracefully in your application.

### Example
```kotlin
craftManager.getDataRecord(
    modelName = MODEL_NAME,
    addonId = ADDON_ID,
    addonVersion = ADDON_VERSION,
    endpointVersion = ENDPOINT_VERSION,
    limit = RECORDS_FETCH_LIMIT,
    onSuccess = { response ->
        val getDataResponse = GetDataResponseConverter.from(response)
        isDataAvailable = getDataResponse.isNotEmpty()
    },
    onFailure = {
        isDataAvailable = false
        Toast.makeText(context, it.message, Toast.LENGTH_SHORT).show()
    }
)
```

---

## `submitDataRecord()`

Submits a data record to the HumaCraft backend.

### Function Signature

```kotlin
fun submitDataRecord(
    modelName: String,
    dataRecord: Any,
    addonId: String,
    addonVersion: String,
    endpointVersion: Int,
    onSuccess: (Any) -> Unit,
    onFailure: (Throwable) -> Unit
)
```

### Parameters

| Name              | Type                  | Description                                    |
|-------------------|-----------------------|------------------------------------------------|
| `modelName`       | `String`              | The name of the model to submit data to.       |
| `dataRecord`      | `Any`                 | The data object to be submitted.               |
| `addonId`         | `String`              | The unique identifier of the addon.            |
| `addonVersion`    | `String`              | The version of the addon being used.           |
| `endpointVersion` | `Int`                 | The API version of the endpoint.               |
| `onSuccess`       | `(Any) -> Unit`       | Callback invoked on successful submission.     |
| `onFailure`       | `(Throwable) -> Unit` | Callback invoked when an error occurs.         |

### Handling Callbacks in `submitDataRecord`

#### `onSuccess` Callback

The `onSuccess` callback is triggered when the data record is successfully submitted to the HumaCraft
backend. It provides an `Any` object, which represents the success response returned by the server.

Since the response type is generic (`Any`), you will need to create a converter to cast or parse this
object into a specific success data class that matches your use case.

You can refer to the provided sample app for an example of how to properly parse and convert this
data.

#### `onFailure` Callback

The `onFailure` callback is invoked when the data submission fails. It provides a `Throwable` object
containing detailed information about the error, such as network issues, invalid data, or server
errors.

You can use this throwable to log the error, show user feedback, or trigger retry logic in your app.

### Example
```kotlin
val userModel = UserModel(id = 1, name = "Alice")
craftManager.submitDataRecord(
    modelName = MODEL_NAME,
    dataRecord = userModel,
    addonId = ADDON_ID,
    addonVersion = ADDON_VERSION,
    endpointVersion = ENDPOINT_VERSION,
    onSuccess = { response ->
        val submissionResult = SubmissionResponseConverter.from(response)
        isSubmissionSuccessful = submissionResult.success == true
    },
    onFailure = {
        Toast.makeText(context, it.message, Toast.LENGTH_SHORT).show()
    }
)
```

---

## Endpoint Structure

Internally, the Craft Package constructs the following endpoints:
```kotlin
// GET
"/dj/craft/models/$modelName/v$endpointVersion/?addon_id=$addonId&version=$addonVersion&limit=$limit"

// POST
"/dj/craft/models/$modelName/v$endpointVersion/"
```

> ℹ️ These endpoints are subject to change.

---

